<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="TIL" /><meta name="author" content="Jaegoo Kim" /><meta property="og:locale" content="en" /><meta name="description" content="2022-09-13 new(T) vs Make(T) new(T) allocates zeroed storage for a new item of type T and returns its address as a value of type *T make(T) returns an initialized value of type T. For slices, maps and channels: use make For arrays, structs and all value types: use new Go Best practices value type에 대한 pointer를 misuse하지 말기, 이는 stack에 있는 값을 heap영역으로 복사하게 되면서 추가적으로 메모리 할당이 일어나게 된다. 변수이름은 구현체가 안드러나도록, 추상화레벨에 맞추는것이 좋다.(eg. redisPubSub대신 그것을 추상화한 broadcastQueue) sync.map vs map + mutex sync.map : 동기화에 대한 부담이 줄어들지만 key,value의 타입을 명시적으로 선언해주지 못한다는 단점존재 map과 mutex 사용 : key,value의 타입을 명시적으로 지정가능, 동기화에 대한 부담 가중" /><meta property="og:description" content="2022-09-13 new(T) vs Make(T) new(T) allocates zeroed storage for a new item of type T and returns its address as a value of type *T make(T) returns an initialized value of type T. For slices, maps and channels: use make For arrays, structs and all value types: use new Go Best practices value type에 대한 pointer를 misuse하지 말기, 이는 stack에 있는 값을 heap영역으로 복사하게 되면서 추가적으로 메모리 할당이 일어나게 된다. 변수이름은 구현체가 안드러나도록, 추상화레벨에 맞추는것이 좋다.(eg. redisPubSub대신 그것을 추상화한 broadcastQueue) sync.map vs map + mutex sync.map : 동기화에 대한 부담이 줄어들지만 key,value의 타입을 명시적으로 선언해주지 못한다는 단점존재 map과 mutex 사용 : key,value의 타입을 명시적으로 지정가능, 동기화에 대한 부담 가중" /><link rel="canonical" href="https://jaegukim.github.io/posts/til/" /><meta property="og:url" content="https://jaegukim.github.io/posts/til/" /><meta property="og:site_name" content="Study Log" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-09-13T13:17:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="TIL" /><meta name="twitter:site" content="@JaeguKim" /><meta name="twitter:creator" content="@Jaegoo Kim" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Jaegoo Kim"},"dateModified":"2023-09-28T08:34:08+08:00","datePublished":"2022-09-13T13:17:00+08:00","description":"2022-09-13 new(T) vs Make(T) new(T) allocates zeroed storage for a new item of type T and returns its address as a value of type *T make(T) returns an initialized value of type T. For slices, maps and channels: use make For arrays, structs and all value types: use new Go Best practices value type에 대한 pointer를 misuse하지 말기, 이는 stack에 있는 값을 heap영역으로 복사하게 되면서 추가적으로 메모리 할당이 일어나게 된다. 변수이름은 구현체가 안드러나도록, 추상화레벨에 맞추는것이 좋다.(eg. redisPubSub대신 그것을 추상화한 broadcastQueue) sync.map vs map + mutex sync.map : 동기화에 대한 부담이 줄어들지만 key,value의 타입을 명시적으로 선언해주지 못한다는 단점존재 map과 mutex 사용 : key,value의 타입을 명시적으로 지정가능, 동기화에 대한 부담 가중","headline":"TIL","mainEntityOfPage":{"@type":"WebPage","@id":"https://jaegukim.github.io/posts/til/"},"url":"https://jaegukim.github.io/posts/til/"}</script><title>TIL | Study Log</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Study Log"><meta name="application-name" content="Study Log"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/22807942?s=460&u=cc1d822a8be2c87ac3aa4917adaadeca5487c515&v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Study Log</a></div><div class="site-subtitle font-italic">“ In order to be irreplaceable, one must always be different” – Coco Chanel</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/JaeguKim" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/JaeguKim" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['kimwithglasses','kakao.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>TIL</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>TIL</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Jaegoo.Kim </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Sep 13, 2022, 1:17 PM +0800" >Sep 13, 2022<i class="unloaded">2022-09-13T13:17:00+08:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Thu, Sep 28, 2023, 9:34 AM +0900" >Sep 28<i class="unloaded">2023-09-28T08:34:08+08:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="5640 words">31 min read</span></div></div><div class="post-content"><h2 id="2022-09-13">2022-09-13</h2><ul><li><code class="language-plaintext highlighter-rouge">new(T)</code> vs <code class="language-plaintext highlighter-rouge">Make(T)</code><ul><li><code class="language-plaintext highlighter-rouge">new(T)</code> allocates zeroed storage for a new item of type T and returns its address as a value of type *T<li><code class="language-plaintext highlighter-rouge">make(T)</code> returns an initialized value of type T.<li>For slices, maps and channels: use <code class="language-plaintext highlighter-rouge">make</code><li>For arrays, structs and all value types: use <code class="language-plaintext highlighter-rouge">new</code></ul><li>Go Best practices<ul><li>value type에 대한 pointer를 misuse하지 말기, 이는 stack에 있는 값을 heap영역으로 복사하게 되면서 추가적으로 메모리 할당이 일어나게 된다.</ul><li>변수이름은 구현체가 안드러나도록, 추상화레벨에 맞추는것이 좋다.(eg. redisPubSub대신 그것을 추상화한 broadcastQueue)<li>sync.map vs map + mutex<ul><li>sync.map : 동기화에 대한 부담이 줄어들지만 key,value의 타입을 명시적으로 선언해주지 못한다는 단점존재<li>map과 mutex 사용 : key,value의 타입을 명시적으로 지정가능, 동기화에 대한 부담 가중</ul></ul><h2 id="2022-09-16">2022-09-16</h2><ul><li>코드 리뷰중 배운사항<ul><li>새로운 파일을 git에 추가시, 파일의 맨마지막에 newline을 반드시 추가하는것이 컨벤션이다. 이렇게 해야하는 이유는 다음에 파일을 수정할때 newline을 입력하면서 diff에 newline입력부분이 포함되어 지저분해지기 때문이다. GoLand에서는 파일 저장시 자동으로 newline을 삽입하도록 설정할수 있다.(2022.2 버전기준으로 Preferences -&gt; Editor -&gt; General -&gt; OnSave 하단에 Ensure every file ends with a line break)<li>윈도우에서는 newline문자를 crlf를 사용하고 unix/linux에서는 lf를 사용한다. 만약 윈도우에서 작업한 파일을 클론하여 수정하면 crlf 문자를 lf로 변환하는 불필요한 diff가 발생하게 된다. 이를 해결하기 위해서 <code class="language-plaintext highlighter-rouge">core.autocrlf</code> 설정을 세팅해야 한다. 아래와 같은 옵션이 있는데 mac의 경우 input으로 설정하고 windows의 경우 true로 설정해야 한다.<ul><li>core.autocrlf = false. 기본 설정이다. 파일에 CRLF 를 썼든 LF 를 썼든 git 은 상관하지 않고 파일 그대로 checkin, checkout 한다. 이 설정은 line ending 이 다른 OS 에서는 text file 이 변경되었다고 나오므로 위에서 언급한 여러 가지 문제가 발생할 수 있다.<li>core.autocrlf = true text file을 object database 에 넣기전에 CRLF 를 LF 로 변경한다.<li>core.autocrlf = input LF를 line ending 으로 사용한다.</ul><li>git commit 메시지 작성요령 : <code class="language-plaintext highlighter-rouge">https://meetup.toast.com/posts/106</code><ul><li>여기서 명령형으로 하는 이유가 git에서 자동생성된 커밋과 위화감 없게 하기위함 이라니 신기했다.<li>커밋 메시지의 첫문자는 항상 대문자, 명령형으로 시작하기!</ul></ul><li>동료의 개발환경 세팅을 도와주던중 <code class="language-plaintext highlighter-rouge">protoc output: protoc error: fork/exec /usr/local/bin/protoc: exec format error</code> 라는 에러를 보게되었는데 이것을 보고 protoc 실행에 문제가 있다고 의심을 했어야 했다. 그런데 m1 mac이라서 protoc가 제대로 동작하지 않을거라고 망상했다. 소경이 소경을 인도할수는 없다. 항상 글자 그대로 받아들이는 연습을 해야겠다.<li>context.Context 패키지 cancelFunc 함수가 여러번 호출되는 경우, 어떻게 동작할까 궁금해서 구글링을 먼저했는데 답이 잘 나오지 않았다. 내부 코드에 있는 주석을 보고나서 바로 파악할 수 있었다. 항상 쉬운 방법을 고집할것이 아니라 가장 정석적인 방법도 염두에 두어야 겠다.</ul><h3 id="go-lang에서-파라미터에-인터페이스-타입을-포인터로-정의해둘지-여부에-대한-따른-고찰">Go lang에서 파라미터에 인터페이스 타입을 포인터로 정의해둘지 여부에 대한 따른 고찰</h3><ul><li>일반적으로 인터페이스 타입을 포인터 타입으로 정의해둘 필요는 거의 없다.<li>파라미터로 넘길 struct에서 value 리시버로 메소드를 정의해둔 경우 값으로 넘기든 포인터로 넘기든 상관없다.<li>반면 포인터 리시버로 메소드를 정의해둔 경우, 함수 파라미터 타입이 값 인터페이스 타입이더라도 반드시 struct의 주소를 넘기도록 강제하고 있다.</ul><div lang="go" class="language-go highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">type</span> <span class="n">Iface</span> <span class="k">interface</span> <span class="p">{</span>
    <span class="n">foo</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">var</span> <span class="n">_</span> <span class="n">Iface</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">Impl1</span><span class="p">)(</span><span class="no">nil</span><span class="p">)</span>

<span class="k">type</span> <span class="n">Impl1</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">mp</span> <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">i</span> <span class="n">Impl1</span><span class="p">)</span> <span class="n">foo</span><span class="p">()</span> <span class="p">{</span>

<span class="p">}</span>

<span class="k">var</span> <span class="n">_</span> <span class="n">Iface</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">Impl2</span><span class="p">)(</span><span class="no">nil</span><span class="p">)</span>

<span class="k">type</span> <span class="n">Impl2</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">mp</span> <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span><span class="n">Impl2</span><span class="p">)</span> <span class="n">foo</span><span class="p">()</span> <span class="p">{</span>

<span class="p">}</span>

<span class="k">func</span> <span class="n">baz</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">i1</span> <span class="o">:=</span> <span class="n">Impl1</span><span class="p">{}</span>
    <span class="n">boo</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span>
    <span class="n">boo</span><span class="p">(</span><span class="o">&amp;</span><span class="n">i1</span><span class="p">)</span>

    <span class="n">i2</span> <span class="o">:=</span> <span class="n">Impl2</span><span class="p">{}</span>
    <span class="n">boo</span><span class="p">(</span><span class="n">i2</span><span class="p">)</span> <span class="c">// compile error가 난다.</span>
    <span class="n">boo</span><span class="p">(</span><span class="o">&amp;</span><span class="n">i2</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">boo</span><span class="p">(</span><span class="n">iface</span> <span class="n">Iface</span><span class="p">)</span> <span class="n">Iface</span> <span class="p">{</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">iface</span>
<span class="p">}</span>
</pre></table></code></div></div><ul><li>slice의 경우 새로운 아이템을 추가할때 새로운 array가 할당되는데, 같은 array가 할당되게 하려면 아래 두가지 방법을 사용할수 있다.</ul><div lang="go" class="language-go highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">func</span> <span class="n">foo1</span><span class="p">(</span><span class="n">s</span> <span class="o">*</span><span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="nb">append</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="s">"ss"</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">foo2</span><span class="p">(</span><span class="n">s</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="p">[]</span><span class="kt">string</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">append</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">"ss"</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="2022-09-15">2022-09-15</h2><ul><li>GoLand에서 code inspection 기능을 사용하면 채널 close나 context.cancel() 함수 처럼 빠뜨리기 쉬운 작업들이 제대로 되었는가 체크할수 있다.<li>go의 convention상 context.Context 타입의 입력 파라미터는 항상 맨 앞에 와야하고 error 타입의 파라미터는 맨뒤에 와야 한다.</ul><h2 id="2022-09-21">2022-09-21</h2><ul><li>error 로그를 찍을때 상세한 정보 추가하기<li>grpc에서 클라이언트로 에러를 내려줄때 응답코드 내려주기<li>grpc 핸들러에서 코드는 ans struct 생성, 작업, 결과 리턴 패턴으로 작성</ul><h2 id="2022-09-23">2022-09-23</h2><h3 id="blocking-vs-non-blocking">blocking vs non-blocking</h3><ul><li>Blocking<ul><li>A 함수가 B 함수를 호출 할 때, B 함수가 자신의 작업이 종료되기 전까지 A 함수에게 제어권을 돌려주지 않는 것</ul><li>Non-blocking<ul><li>A 함수가 B 함수를 호출 할 때, B 함수가 제어권을 바로 A 함수에게 넘겨주면서, A 함수가 다른 일을 할 수 있도록 하는 것.</ul></ul><h3 id="synchronous-vs-asynchronous">Synchronous vs Asynchronous</h3><ul><li>Synchronous<ul><li>A 함수가 B 함수를 호출 할 때, B 함수의 결과를 A 함수가 처리하는 것.</ul><li>Asynchronous<ul><li>A 함수가 B 함수를 호출 할 때, B 함수의 결과를 B 함수가 처리하는 것.</ul></ul><h2 id="2022-09-30">2022-09-30</h2><ul><li>server repo pr 올릴때 관련된 다른 pr 링크도 description에 명시할것<li>영역구분 등과 같이 의미가 적은 주석 사용하지 않기<li>추후에 수정해야하는 부분은 <code class="language-plaintext highlighter-rouge">TODO</code>, <code class="language-plaintext highlighter-rouge">FIXME</code>로 시작하는 코멘트 추가 또는 해당 라인에 pr comment 달기<li>RWLock의 경우, Reader가 락을 잡고 있는 동안 다른 Reader가 CS에 진입이 가능하고 다른 Writer는 Reader가 unlock할때까지 대기한다. Writer가 락을 잡으면 그 동안 Reader는 대기한다.(<a href="https://medium.com/golangspec/sync-rwmutex-ca6c6c3208a0">참고</a>)</ul><h2 id="2022-10-24">2022-10-24</h2><ul><li>Go에서 pointer interface 타입은 사용하지 않는다. 인터페이스 타입은 인터페이스에 저장된 타입정보에 대한 포인터와 연관된 데이터에 대한 포인터를 저장하기 때문이다. <a href="https://stackoverflow.com/a/13511853/8276700">참고</a></ul><h2 id="2022-11-08">2022-11-08</h2><ul><li>Fake, mock, stub 차이점<ul><li>Fake object : 실제로 동작하는 구현이지만 production에는 suitable하지 않은 것입니다.<li>Mock object : 실제 객체를 모방하여 테스트용으로 작성한 특수 케이스 객체<li>Stub : 미리 준비된 응답만 제공하기 위해 테스트용으로 작성한 것. 즉, 반환값만 맞춰 준 것.<li>Spy : Stub이긴 한데 호출 방식에 따른 정보 기록(record) 까지 수행</ul><li><a href="https://github.com/uber-go/guide/blob/master/style.md#test-tables">Uber Go Style Guide</a></ul><h2 id="2022-11-11">2022-11-11</h2><ul><li>Mac 업데이트후 몇몇 프로그램 설치가 안되있는경우 설치방법<ul><li>diff 설치 : <code class="language-plaintext highlighter-rouge">brew install diffutils</code><li>realpath 설치 : <code class="language-plaintext highlighter-rouge">brew install coreutils</code></ul></ul><h2 id="2022-11-14">2022-11-14</h2><ul><li>Makefile시 .PHONY 사용하는 이유<ul><li>target과 실제 파일 이름이 동일할시 기본은 파일에 있는 커멘드를 실행한다. 하지만 .PHONY에 명시할경우 target이 실행된다.<li>하위 make에서 에러가 발생할때 커멘드를 중지, 커멘드를 병렬로 실행할수 있도록 제공</ul><li>Mac에서 구름입력기 설치하여 폰트 한글 입력속도 개선하기<ul><li>https://github.com/gureum/gureum/wiki/Help-Install</ul><li>Unix File Permissions<ul><li>1번째 비트 : 디렉토리면 “d” 아니면 “-“<li>2,3,4번째 비트 : file의 user(owner)에 대한 read,write,execute permission<li>5,6,7번째 비트 : group에 대한 read,write,execute permission<li>8,9,10번째 비트 : other(world)에 대한 read,write,execute permission</ul></ul><h2 id="2022-12-06">2022-12-06</h2><ul><li>Go에서 map을 초기화할때 가능하면 아래와 같이 capacity hint를 제공하는것이 좋다.<ul><li>slice와 달리 complete, preemptive allocation을 보장해주지는 못하지만 필요한 hashmap bucket의 수를 approximate하는데 사용된다.</ul><li>Slice을 초기화할때 Capacity를 가능하면 명시하기<ul><li>capacity를 명시해두면 compiler가 slice capacity를 위한 충분한 메모리를 할당해주며, slice 길이가 capacity에 도달하기 전까지는 연속적인 append작업시 추가적인 메모리 할당을 유발하지않는다.</ul></ul><h2 id="2022-12-07">2022-12-07</h2><ul><li><a href="https://github.com/uber-go/guide/blob/master/style.md#test-tables">Uber Go Style Guide</a> 문서를 1회독 했다. 주기적으로 읽으면 좋을것같다.</ul><h2 id="2022-12-13">2022-12-13</h2><ul><li>Golang에서 reference variable은 없음<ul><li>map타입은 내부적으로 <code class="language-plaintext highlighter-rouge">func makemap(t *maptype, hint int64, h *hmap, bucket unsafe.Pointer) *hmap</code> 함수의 리턴값이며, 따라서 hmap에 대한 pointer이다. 즉 hmap에 대한 주소값을 담은 uintptr를 리턴할 뿐이다. 리턴한 값에 새로운 map을 할당한다고 해서 원래 pointer가 가리키고 있던 map에는 아무 영향이 없다.<li>map타입은 pointer 타입인데 왜 *map으로 정의하지 않는가?<ul><li>*map[int]int 형태로 정의할 경우,map을 사용하는 사람들이 *map 이외의 형태로 사용하는 사람은 없기때문에, *map[타입]타입을 map[타입]타입 으로 리네임한것 뿐이다.</ul></ul></ul><h2 id="2022-12-20">2022-12-20</h2><ul><li>만약 길이가 0인 slice를 선언한다면 make나 []int{}로 정의하기 보다는 <code class="language-plaintext highlighter-rouge">var nums []int</code> 로 하는것이 낫다.<li>항상 할당과 동시에 선언할수 있으면 하는것이 낫다.</ul><h2 id="2023-01-13">2023-01-13</h2><ul><li><code class="language-plaintext highlighter-rouge">go mod download</code><ul><li><code class="language-plaintext highlighter-rouge">go.mod</code>파일을 읽어서 모듈을 다운받기만 한다.</ul><li><code class="language-plaintext highlighter-rouge">go mod tidy</code><ul><li>package graph를 순회하고 <code class="language-plaintext highlighter-rouge">go.mod</code>파일에서 빌드에 필요한 부분만 남기고 나머지는 정리한다.</ul><li><code class="language-plaintext highlighter-rouge">go get</code><ul><li>package 다운로드 이후에 install</ul><li><code class="language-plaintext highlighter-rouge">go install</code><ul><li>다운로드된 모듈 install</ul></ul><h2 id="2023-01-26">2023-01-26</h2><ul><li>네이티브 안드로이드 개발자 입장에서의 gRPC장단점<ul><li>장점<ul><li>속도향상<li>코드 제너레이션</ul><li>단점(+ 회의적인 부분)<ul><li>추가 학습 필요<li>안드로이드 스튜디오에서 지원하는 gRPC 라이브러리들이 안정적이지 않음<li>안드로이드 스튜디오 업데이트시 기존의 gRPC 라이브러리를 지원하지 않음<li>애초에 큰 데이터를 받아오지 않는 네이티브 앱의 경우, 속도 향상폭이 크지않음, 따라서 gRPC+RestAPI 하이브리드로 가는것도 좋음</ul></ul></ul><h2 id="2023-02-01">2023-02-01</h2><ul><li>Github에서 compare기능 사용하여 두 repo 버전 비교<ul><li>변경된 파일 리스팅: github.com/[organization]/[repo name]/compare/[branch or commit sha]..[branch name]<li>변경된 커밋이력 리스팅: github.com/[organization]/[repo name]/compare/[branch or commit sha]…[branch name]<li>자세한 설명 : https://docs.github.com/en/pull-requests/committing-changes-to-your-project/viewing-and-comparing-commits/comparing-commits<li>주로 코드 리뷰에서 특정 부분커밋만을 보여주고 싶을때 유용할것 같다.</ul></ul><h2 id="2023-02-08">2023-02-08</h2><ul><li>brew 커멘트 실행시 <code class="language-plaintext highlighter-rouge">cannot load such file -- active_support/core_ext/object/blank</code> 에러가 발생하면 <code class="language-plaintext highlighter-rouge">brew update-reset</code> 실행</ul><h2 id="2023-03-12">2023-03-12</h2><h3 id="mac에서-배치로-스크립트-실행하기">Mac에서 배치로 스크립트 실행하기</h3><p>아래는 5분마다 특정 경로의 shell 스크립트 실행하는 예제임. <code class="language-plaintext highlighter-rouge">/Users/{유저네임}/Library/LaunchAgents</code> 디렉토리에 <code class="language-plaintext highlighter-rouge">sdm.simple.TerminateDisplaylink.plist</code> 파일을 생성하고 파일 내용은 아래로 설정(sh 스크립트는 Desktop이나 Download 디렉토리에 위치시키면 실행할 권한이 없으므로 위치하지 않도록 유의!)</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;
&lt;plist version="1.0"&gt;
&lt;dict&gt;
    &lt;key&gt;Label&lt;/key&gt;
    &lt;string&gt;com.example.terminate_displaylink&lt;/string&gt;
    &lt;key&gt;ProgramArguments&lt;/key&gt;
    &lt;array&gt;
        &lt;string&gt;/Users/{유저네임}/terminate_displaylink.sh&lt;/string&gt;
    &lt;/array&gt;
    &lt;key&gt;StartInterval&lt;/key&gt;
    &lt;integer&gt;300&lt;/integer&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</pre></table></code></div></div><h2 id="2023-03-16">2023-03-16</h2><ul><li>Jetbrains IDE에서 하단의 tool window bar 활성화하는 법 : Preferences -&gt; Appearance &amp; Behavior -&gt; Appearance 탭에서 Tool Windows 섹션에 <code class="language-plaintext highlighter-rouge">Show tool window bars</code> 체크</ul><h2 id="2023-03-30">2023-03-30</h2><ul><li>Goland에서 interface implementation으로 이동하기 : <code class="language-plaintext highlighter-rouge">cmd + option + B</code></ul><h2 id="2023-04-01">2023-04-01</h2><ul><li><a href="https://restfulapi.net/">https://restfulapi.net/</a> 문서에 따르면 RESTful 하다고 하면 많이들 HTTP Method와 연관짓는 경우가 많은데, 실제로 이는 관련없다. 중요한건 uniform interface이다.<li>REST vs RESTful<ul><li><a href="https://hevodata.com/learn/rest-vs-restful-apis/#5">참고 글</a><li>Cacheability<ul><li>REST의 경우 cacheable한 리소스와 그렇지 않은 리소스를 구분한다.<li>반면 RESTful API의 경우에는 모든 리소스가 cacheable하다.</ul><li>Stability<ul><li>REST에서 서바와 클라이언트는 서로의 상태정보를 저장하지 않는다.<li>RESTful에서는 서버와 클라리언트는 서로 데이터와 상태를 주고 받는다.<li>REST에서는 분명 stateless라고 했는데, 이러면 REST 인터페이스를 준수한건지 솔직히 잘 모르겠다. 이래도 과연 RESTful하다고 할수 있는지..?</ul><li>Multi-layered architecture<ul><li>REST에서는 클라이언트가 직접 소통하는 레이어 너머를 알수 없다.<li>RESTful에서는 클라이언트가 여러 레이어와 소통가능하다.</ul></ul></ul><h2 id="2023-04-03">2023-04-03</h2><ul><li><code class="language-plaintext highlighter-rouge">go get</code>은 디폴트로 아래와같이 동작<ul><li>import path가 github.com으로 시작하면 해당 패키지rk github.com 호스팅과 git vcs를 사용한다고 판단하며 <code class="language-plaintext highlighter-rouge">https://</code>와 <code class="language-plaintext highlighter-rouge">git+ssh://</code> 스키마 순서로 다운로드를 시도한다.<li><code class="language-plaintext highlighter-rouge">https://proxy.golang.org</code>에서 미러링된 모듈 검색<li>모듈을 발견하면 다운받고 <code class="language-plaintext highlighter-rouge">go.sum</code>파일에서 체크섬 유무 검사<li><code class="language-plaintext highlighter-rouge">go.sum</code> 업데이트</ul><li>private module의 경우는 퍼블릭 서버에 없으므로 <code class="language-plaintext highlighter-rouge">go get</code> 이 실패한다. 따라서 위 과정을 우회하기 위해서 GOPRIVATE 환경변수 등록<li>github action에서 접근하도록 할때, ssh보다 access token을 통한 접근이 일반적이므로 다음과 같이 git config로 url만 변경<li><code class="language-plaintext highlighter-rouge">$ git config --global url."https://x-access-token:$@github.com/".insteadOf "https://github.com/"</code><li><p>출처 : <a href="https://mingrammer.com/go-modules-private-repo/">https://mingrammer.com/go-modules-private-repo/</a></p><li>6 Ways To Boost the Performance of Your Go Applications<ul><li>application들을 쿠버네티스에서 실행한다면, <code class="language-plaintext highlighter-rouge">GOMAXPROCS</code>을 리눅스 컨테이너 CPU quota와 매치되도록 설정<li>struct fields 정렬하기<li>Garbage collection tune<ul><li>use only <code class="language-plaintext highlighter-rouge">GOMEMLIMIT</code> to trigger Garbage Collection.</ul><li>Use unsafe package to string &lt;-&gt; byte conversion without copying<li>Use jsoniter instead of encoding/json<li>Use sync.Pool to reduce heap allocations</ul><li>Makefile <code class="language-plaintext highlighter-rouge">@</code> sign in the beginning of the recipe<ul><li>means <code class="language-plaintext highlighter-rouge">do not echo the command</code></ul></ul><h2 id="2023-04-04">2023-04-04</h2><ul><li>GoLand에서 Save시 Reformat 자동화하기<ul><li>Preferences -&gt; Actions On Save -&gt; Reformat code에 Files 버튼눌러서 Reformat하고자 하는 파일 확장자 선택</ul></ul><h2 id="2023-04-12">2023-04-12</h2><ul><li>Find all files in current and subfolders based on wildcard matching<ul><li>` find <directory_path> -type f -name "<wildcard-match>" `</wildcard-match></directory_path><li>` find . -name “*.proto” `<li><a href="https://stackoverflow.com/questions/5905054/how-can-i-recursively-find-all-files-in-current-and-subfolders-based-on-wildcard">참고</a></ul><li>assign command result to variable<ul><li><code class="language-plaintext highlighter-rouge">VARIABLE_NAME = $(shell find &lt;driectory_path&gt; -iname "*.proto")</code></ul></ul><h2 id="2023-04-20">2023-04-20</h2><ul><li>항상 코딩할때 포인터가 nil일수 있다는것을 염두해두자.<li>항상 값이 비어있을수 있다는 점을 염두해두자!</ul><h2 id="2023-04-21">2023-04-21</h2><ul><li>자주 놓치는 부분<ul><li>데이터를 저장할때와 읽을때 key를 다르게 사용하는것<li>로직 처리가 제대로 안되어있는 부분</ul></ul><h2 id="2023-05-02">2023-05-02</h2><ul><li><code class="language-plaintext highlighter-rouge">errors.As</code> vs <code class="language-plaintext highlighter-rouge">errors.Is</code><ul><li>errors.Is는 error를 구현한 타입의 값비교, errors.As는 err가 target으로 assignable하거나 As함수가 true를 반환하는지 체크</ul></ul><div lang="go" class="language-go highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
</pre><td class="rouge-code"><pre>
<span class="k">type</span> <span class="n">MyErrorImplementedByPointerReceiver</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">s</span> <span class="kt">string</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span><span class="n">MyErrorImplementedByPointerReceiver</span><span class="p">)</span> <span class="n">Error</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
	<span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">s</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">MyErrorImplementedByValueReceiver</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">s</span> <span class="kt">string</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">m</span> <span class="n">MyErrorImplementedByValueReceiver</span><span class="p">)</span> <span class="n">Error</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
	<span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">s</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">TestErrorCheck</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">testing</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">var</span> <span class="n">err</span> <span class="kt">error</span>

	<span class="c">/* errors.As 함수의 target에 concrete type를 넘길경우, err와 target의 타입이 정확히 일치해야한다.
	즉, err가 pointer이면 concrete type도 pointer이어야하고, err가 value이면 concrete type도 value이어야한다.
	*/</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">MyErrorImplementedByValueReceiver</span><span class="p">{}</span>
	<span class="n">concreteErr</span> <span class="o">:=</span> <span class="n">MyErrorImplementedByValueReceiver</span><span class="p">{}</span>
	<span class="n">assert</span><span class="o">.</span><span class="n">True</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">As</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">concreteErr</span><span class="p">))</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">MyErrorImplementedByValueReceiver</span><span class="p">{}</span>
	<span class="n">concreteErr2</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="n">MyErrorImplementedByValueReceiver</span><span class="p">{}</span>
	<span class="n">assert</span><span class="o">.</span><span class="n">False</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">As</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">concreteErr2</span><span class="p">))</span>

	<span class="n">err</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">MyErrorImplementedByValueReceiver</span><span class="p">{}</span>
	<span class="n">concreteErr3</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="n">MyErrorImplementedByValueReceiver</span><span class="p">{}</span>
	<span class="n">assert</span><span class="o">.</span><span class="n">True</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">As</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">concreteErr3</span><span class="p">))</span>

	<span class="n">err</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">MyErrorImplementedByValueReceiver</span><span class="p">{}</span>
	<span class="n">concreteErr4</span> <span class="o">:=</span> <span class="n">MyErrorImplementedByValueReceiver</span><span class="p">{}</span>
	<span class="n">assert</span><span class="o">.</span><span class="n">False</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">As</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">concreteErr4</span><span class="p">))</span>

	<span class="c">/* compile error
	second argument to errors.As must be a non-nil pointer to either a type that implements error, or to any interface typesecond argument to errors.As must be a non-nil pointer to either a type that implements error, or to any interface type

	err = &amp;MyErrorImplementedByPointerReceiver{}
	concreteErr5 := MyErrorImplementedByPointerReceiver{}
	assert.True(t, errors.As(err, &amp;concreteErr5))
	*/</span>

	<span class="n">err</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">MyErrorImplementedByPointerReceiver</span><span class="p">{}</span>
	<span class="n">concreteErr6</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="n">MyErrorImplementedByPointerReceiver</span><span class="p">{}</span>
	<span class="n">assert</span><span class="o">.</span><span class="n">True</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">As</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">concreteErr6</span><span class="p">))</span>

	<span class="c">/* 아래 처럼 target을 error interface 타입으로 넘기면 값으로 넘기든 포인터로 넘기든 상관없다. */</span>
	<span class="k">var</span> <span class="n">err2</span> <span class="kt">error</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">MyErrorImplementedByValueReceiver</span><span class="p">{}</span>
	<span class="n">err2</span> <span class="o">=</span> <span class="n">MyErrorImplementedByValueReceiver</span><span class="p">{}</span>
	<span class="n">assert</span><span class="o">.</span><span class="n">True</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">As</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">err2</span><span class="p">))</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">MyErrorImplementedByValueReceiver</span><span class="p">{}</span>
	<span class="n">err2</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">MyErrorImplementedByValueReceiver</span><span class="p">{}</span>
	<span class="n">assert</span><span class="o">.</span><span class="n">True</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">As</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">err2</span><span class="p">))</span>

	<span class="n">err</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">MyErrorImplementedByValueReceiver</span><span class="p">{}</span>
	<span class="n">err2</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">MyErrorImplementedByValueReceiver</span><span class="p">{}</span>
	<span class="n">assert</span><span class="o">.</span><span class="n">True</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">As</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">err2</span><span class="p">))</span>

	<span class="n">err</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">MyErrorImplementedByValueReceiver</span><span class="p">{}</span>
	<span class="n">err2</span> <span class="o">=</span> <span class="n">MyErrorImplementedByValueReceiver</span><span class="p">{}</span>
	<span class="n">assert</span><span class="o">.</span><span class="n">True</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">As</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">err2</span><span class="p">))</span>

	<span class="n">err</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">MyErrorImplementedByPointerReceiver</span><span class="p">{}</span>
	<span class="n">err2</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">MyErrorImplementedByPointerReceiver</span><span class="p">{}</span>
	<span class="n">assert</span><span class="o">.</span><span class="n">True</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">As</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">err2</span><span class="p">))</span>

	<span class="c">/* errors.Is 함수에는 두개의 파리미터중 포인터가 있으면 실제 같은 인스턴스인지 체크하고, 그렇지 않으면 값을 비교한다. */</span>
	<span class="n">test</span> <span class="o">:=</span> <span class="n">MyErrorImplementedByValueReceiver</span><span class="p">{}</span>
	<span class="n">test</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="s">"test"</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">test</span>
	<span class="n">concreteErr7</span> <span class="o">:=</span> <span class="n">MyErrorImplementedByValueReceiver</span><span class="p">{}</span>
	<span class="n">concreteErr7</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="s">"test"</span>
	<span class="n">err2</span> <span class="o">=</span> <span class="n">concreteErr7</span>
	<span class="n">assert</span><span class="o">.</span><span class="n">True</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">Is</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">err2</span><span class="p">))</span>

	<span class="n">test</span> <span class="o">=</span> <span class="n">MyErrorImplementedByValueReceiver</span><span class="p">{}</span>
	<span class="n">test</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="s">"test1"</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">test</span>
	<span class="n">concreteErr8</span> <span class="o">:=</span> <span class="n">MyErrorImplementedByValueReceiver</span><span class="p">{}</span>
	<span class="n">concreteErr8</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="s">"test"</span>
	<span class="n">err2</span> <span class="o">=</span> <span class="n">concreteErr8</span>
	<span class="n">assert</span><span class="o">.</span><span class="n">False</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">Is</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">err2</span><span class="p">))</span>

	<span class="n">test2</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="n">MyErrorImplementedByPointerReceiver</span><span class="p">{}</span>
	<span class="n">test2</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="s">"test"</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">test2</span>
	<span class="n">concreteErr9</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="n">MyErrorImplementedByPointerReceiver</span><span class="p">{}</span>
	<span class="n">concreteErr9</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="s">"test"</span>
	<span class="n">err2</span> <span class="o">=</span> <span class="n">concreteErr9</span>
	<span class="n">assert</span><span class="o">.</span><span class="n">False</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">Is</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">err2</span><span class="p">))</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="2023-05-04">2023-05-04</h2><ul><li>큰 단위의 함수를 테스트하는것은 비용이 많이 든다. 의존하는 컴포넌트들도 많고 각각의 컴포넌트들의 실행결과를 원하는 결과로 대체할수 있어야하기 때문이다. 게다가 실제 코드에서 모킹을 도저히 하기 어려운 점도 분명 존재한다. 가장 비용대비 효용이 큰 테스트는 도메인 코드들이기때문에, 이 코드들을 테스트하기 쉬운 구조로 리팩토링을 하는것도 중요해 보인다. 함수를 묶어서 처리하는 식으로 말이다. 그리고 그 함수들을 테스트하는것이 좋지 않을까 싶다. 그리고 각각의 컴포넌트들을 조합해서 실행하는 코드들에 대해서는 각각의 컴포넌트들을 쉽게 모킹할수 있어야 하는데, 현재 구조에서는 각각의 컴포넌트가 구체타입으로 되어있기 때문에 가짜구현으로 대체하는것이 불가능하다.(적어도 상속이 없는 고랭에서는 그래보인다, 그것이 가능하다고 해도 안티패턴이다.)</ul><h2 id="2023-05-10">2023-05-10</h2><ul><li>오늘 go-redis go 패키지를 사용해서, hset 오퍼레이션을 처리할때 <code class="language-plaintext highlighter-rouge">"redis: can't marshal %T (implement encoding.BinaryMarshaler)"</code> 에러가 발생했다. 이것의 원인은 hset함수의 value로 넘기는 타입으로 몇가지 타입만(<code class="language-plaintext highlighter-rouge">map[string]string</code>, <code class="language-plaintext highlighter-rouge">map[string]interface{}</code>, <code class="language-plaintext highlighter-rouge">[]string</code>, <code class="language-plaintext highlighter-rouge">[]interface</code>)을 지원하기 때문에 발생하였다. value의 타입을 any가 아니고 몇가지 타입중 하나로 제한하면 더 좋을것같다.<li>Jira에서 predefined task 설정하려면, 티켓에 Move버튼을 클릭!</ul><h2 id="2023-05-19">2023-05-19</h2><ul><li>golang에서 <code class="language-plaintext highlighter-rouge">sync.WaitGroup</code> 사용시 주의할점: <code class="language-plaintext highlighter-rouge">waitGroup</code>의 <code class="language-plaintext highlighter-rouge">Add</code>와 <code class="language-plaintext highlighter-rouge">Done</code> 함수는 하나의 Goroutine에서 호출되는것이 원칙이다.<li>항상 golang 채널에 대한 소유권은 송신측에서 한다. 수신측에서 채널을 임의로 close하면 송신측에서 panic이 발생할수 있다.</ul><h2 id="2023-06-03">2023-06-03</h2><ul><li><code class="language-plaintext highlighter-rouge">git diff-index --quiet HEAD</code> : HEAD에 명시된 파일들과 현재 디렉토리에 있는 파일들을 비교하되 출력은 하지 않는다.<li><code class="language-plaintext highlighter-rouge">git diff-index --quiet HEAD || git commit -m "Add changes" &amp;&amp; git push</code> : 현재 stage된 파일들이 없다면 <code class="language-plaintext highlighter-rouge">git diff-index --quiet HEAD</code> 이 부분은 true가 되며, 만약 stage된 파일이 존재하면 나머지 부분이 실행된다.</ul><h2 id="2023-06-16">2023-06-16</h2><ul><li>client에서 128bit uuid(v4)를 저장할때 string으로 받아서 저장하면 36byte 공간을 차지하므로 이 공간을 줄일필요가 있었다.<ul><li>이를 줄이기 위한 방안을 팀에서 모색하는데 다음과 같은 아이디어가 있었다.<ul><li>서버에서 클라이언트로 uuid를 int64 두개로 나눠서 전달<li>클라이언트에서 uuid를 byte시퀀스로 저장<li>64bit 공간을 차지하는 <a href="https://en.wikipedia.org/wiki/Snowflake_ID">Snowflake ID</a>를 사용</ul></ul></ul><h2 id="2023-06-23">2023-06-23</h2><ul><li>shell command에서 오류가 발생할 경우 로그 찍고 넘어가게 하려면 아래처럼 하면됨<div lang="shell" class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nb">test</span>:
open ./a.txt <span class="o">||</span> :
<span class="nb">echo</span> <span class="s1">'test'</span>
</pre></table></code></div></div></ul><h2 id="2023-07-05">2023-07-05</h2><ul><li>defer 호출시 주의해야할 상황 ``` go func test() { var a = 1 defer fmt.Println(a) a = 2 }</ul><p>func test1() { var a = 1 defer func() { fmt.Println(a) }() a = 2 }</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre>위의 예시에서 test함수의 결과로는 1이 출력되고, test1함수의 결과로는 2가 출력된다. 이유는 test함수의 경우 a값이 1인 상태로 `fmt.Println(a)`가 콜스택에 쌓기게되고 test1함수의 경우 `func()` 가 콜스택에 쌓이게 되면서, func가 실행되는 시점에 a의 값을 불러오게 된다. 

## 2023-07-12
- float 비교시 주의할점
floating-point 표현때문에 float 수를 비교할때 `=`를 사용하는것은 좋지 않은 방법일 수 있다.
따라서 absolute difference가 small threshold내에 있는지 확인하는것이 좋다.
``` go
package main

import (
	"fmt"
	"math"
)

const epsilon = 1e-9 // You can adjust the precision based on your needs

func AlmostEqual(a, b float64) bool {
	return math.Abs(a-b) &lt;= epsilon
}

func main() {
	num1 := 0.1 + 0.2
	num2 := 0.3

	if AlmostEqual(num1, num2) {
		fmt.Println("num1 and num2 are approximately equal")
	} else {
		fmt.Println("num1 and num2 are not equal")
	}
}
</pre></table></code></div></div><h2 id="2023-09-06">2023-09-06</h2><ul><li>var 키워드로 map을 선언할경우 nil이 됨을 유의해야함. 따라서 아래처럼 선언해야함.<div lang="go" class="language-go highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">mp</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">)</span>
</pre></table></code></div></div></ul><h2 id="2023-09-28">2023-09-28</h2><ul><li>구조체에 포인터 변수가 있으면서 항상 nil 체크를 해야한다. 그렇지 않으면 서버가 죽어버리고 응답성이 확 나빠진다. 경험을 통해서 느끼니 배우는 깊이가 다른듯하다.</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/study/'>Study</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=TIL - Study Log&url=https://jaegukim.github.io/posts/til/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=TIL - Study Log&u=https://jaegukim.github.io/posts/til/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=TIL - Study Log&url=https://jaegukim.github.io/posts/til/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copied successfully!')" data-toggle="tooltip" data-placement="top" title="Copy link"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/software-engineering-at-google/">Software Engineering at Google</a><li><a href="/posts/til/">TIL</a><li><a href="/posts/custom-default-backend-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0/">custom error page 띄우기</a><li><a href="/posts/cors-setting/">CORS setting</a><li><a href="/posts/helm-chart/">Helm Chart</a></ul></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/concurrency-in-go/"><div class="card-body"> <span class="timeago small" >Aug 30, 2022<i class="unloaded">2022-08-30T11:16:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Concurrency in Go</h3><div class="text-muted small"><p> 1. 동시성 소개 라이브락이란 프로그램들이 활동적으로 동시에 연산을 수행하고는 있찌만, 이 연산들이 실제로 프로그램의 상태를 진행시키는데 아무런 영향을 주지 못하는 의미 없는 연산 상태를 의미한다. 동기화된 메모리 접근에는 비용이 많이 들기 때문에 임계 영역 너머까지 잠금을 확장하는 것이 유리할 수 있다. 반면에 이렇게 하면 다른 동시 프로세...</p></div></div></a></div><div class="card"> <a href="/posts/effective-sql-item1-%EB%AA%A8%EB%93%A0-%ED%85%8C%EC%9D%B4%EB%B8%94%EC%9D%B4-pk%EB%A5%BC-%EA%B0%80%EC%A7%80%EA%B3%A0-%EC%9E%88%EB%8A%94%EC%A7%80-%EA%B2%80%EC%A6%9D%ED%95%98%EB%9D%BC/"><div class="card-body"> <span class="timeago small" >Jun 16, 2021<i class="unloaded">2021-06-16T17:47:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[Effective SQL] item1 : 모든 테이블이 PK를 가지고 있는지 검증하라.</h3><div class="text-muted small"><p> 먼저 Chapter 1부터 소개를 하자면, 제목이 Data Model Design이다. 저자는 bad data model design을 가진 디비에서 효과적인 SQL을 작성하기는 힘들다고 말한다. 즉, data model이 적절히 정규화되어 있지도 않고 테이블 &gt; 관계도 정확히 설정되어 있지 않은 경우는 효과적인 SQL을 작성하는것이 어렵...</p></div></div></a></div><div class="card"> <a href="/posts/software-engineering-at-google/"><div class="card-body"> <span class="timeago small" >Oct 2<i class="unloaded">2023-10-02T19:12:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Software Engineering at Google</h3><div class="text-muted small"><p> 챕터1 Time and Change Software를 장기적으로 유지보수가능하게 하는 작업은 지속적인 전투(constant battle)이다. Hyrum’s Law API의 충분한 사용자가 있는 경우, 주어진 계약에서 무엇을 약속하는지는 중요하지 않다. : 모든 관찰가능한 당신의 시스템의 행위가 다른 누군가에 의해 의존될 것이다. ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/concurrency-in-go/" class="btn btn-outline-primary" prompt="Older"><p>Concurrency in Go</p></a> <a href="/posts/9-password-storage-best-practices/" class="btn btn-outline-primary" prompt="Newer"><p>9 Password Storage Best Practices</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//jaegukim.disqus.com/embed.js', disqusConfig: function() { this.page.title = 'TIL'; this.page.url = 'https://jaegukim.github.io/posts/til/'; this.page.identifier = '/posts/til/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/username">Jaegoo.Kim</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://jaegukim.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
