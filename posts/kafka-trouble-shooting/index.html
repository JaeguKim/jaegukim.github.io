<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Kafka Trouble Shooting" /><meta name="author" content="Jaegoo Kim" /><meta property="og:locale" content="en" /><meta name="description" content="The process cannot access the file because it is being used by another process." /><meta property="og:description" content="The process cannot access the file because it is being used by another process." /><link rel="canonical" href="https://jaegukim.github.io/posts/kafka-trouble-shooting/" /><meta property="og:url" content="https://jaegukim.github.io/posts/kafka-trouble-shooting/" /><meta property="og:site_name" content="Study Log" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-12-04T22:35:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Kafka Trouble Shooting" /><meta name="twitter:site" content="@JaeguKim" /><meta name="twitter:creator" content="@Jaegoo Kim" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Jaegoo Kim"},"dateModified":"2022-01-06T23:59:43+08:00","datePublished":"2020-12-04T22:35:00+08:00","description":"The process cannot access the file because it is being used by another process.","headline":"Kafka Trouble Shooting","mainEntityOfPage":{"@type":"WebPage","@id":"https://jaegukim.github.io/posts/kafka-trouble-shooting/"},"url":"https://jaegukim.github.io/posts/kafka-trouble-shooting/"}</script><title>Kafka Trouble Shooting | Study Log</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Study Log"><meta name="application-name" content="Study Log"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/22807942?s=460&u=cc1d822a8be2c87ac3aa4917adaadeca5487c515&v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Study Log</a></div><div class="site-subtitle font-italic">“ In order to be irreplaceable, one must always be different” – Coco Chanel</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/JaeguKim" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/JaeguKim" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['kimwithglasses','kakao.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Kafka Trouble Shooting</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Kafka Trouble Shooting</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Jaegoo.Kim </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Dec 4, 2020, 10:35 PM +0800" >Dec 4, 2020<i class="unloaded">2020-12-04T22:35:00+08:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Fri, Jan 7, 2022, 12:59 AM +0900" >Jan 7, 2022<i class="unloaded">2022-01-06T23:59:43+08:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="563 words">3 min read</span></div></div><div class="post-content"><h2 id="the-process-cannot-access-the-file-because-it-is-being-used-by-another-process">The process cannot access the file because it is being used by another process.</h2><p>위 경우는 다른 카프카가 이미 해당 파일을 사용하고 있기 때문에 발생한다. 가장 빠른 방법은 카프카 포트번호(default 9092)를 사용중인 카프카를 종료시키고 재실행하는 것이다. 즉, 9092 포트를 사용중인 프로세스를 종료시키면된다.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>sudo lsof -t -i tcp:9092 | xargs kill -9
</pre></table></code></div></div><h2 id="kafka-python-패키지에서-unknown-error-fetching-data-for-topic-partition">kafka-python 패키지에서 Unknown error fetching data for topic-partition</h2><p>kafka-python python package가 카프카 브로커 버전 2.5버전과 호환이 되지 않아서 문제가 발생하였다. 21년 12월기준 kafka-python 패키지는 카프카 2.4버전까지만 지원한다.</p><ul><li>해결방법 : confluent_kafka 모듈을 사용하도록 변경</ul><h2 id="confluent_kafka-패키지에서-local-queue-full">confluent_kafka 패키지에서 Local: Queue full</h2><p>confluent_kafka 내부의 internal queue사이즈가 가득찬 경우 발생한다. 주로 <code class="language-plaintext highlighter-rouge">poll([timeout])</code> 함수를 호출하지 않아서 발생한다.</p><blockquote><p><code class="language-plaintext highlighter-rouge">poll([timeout])</code> 함수는 메시지를 카프카 브로커에 전달하고 결과정보를 callback함수를 통해서 전달하는 역할을 한다. <code class="language-plaintext highlighter-rouge">flush[timeout]</code> 함수는 프로듀서 큐에 있는 모든 메시지가 브로커에 전달될때까지 대기한다. 파라미터에 timeout값을 전달하지 않으면 <code class="language-plaintext highlighter-rouge">len()</code>값이 0이 될때까지 <code class="language-plaintext highlighter-rouge">poll()</code>함수를 호출하며, timeout값을 전달하면 해당 값동안 <code class="language-plaintext highlighter-rouge">poll()</code>함수를 호출한다. 결과값으로 queue에 남아있는 메시지수를 리턴한다.</p></blockquote><h2 id="commit-failed-error">COMMIT Failed error</h2><p>주로 Kafka Rebalancing 도중에 commit 요청이 들어올경우 다음의 에러가 발생한다.</p><ul><li><p><code class="language-plaintext highlighter-rouge">Error: KafkaError{code=UNKNOWN_MEMBER_ID,val=25,str="Commit failed: Broker: Unknown member"}</code></p><li><p><code class="language-plaintext highlighter-rouge">Error: KafkaError{code=NOT_COORDINATOR,val=16,str="Commit failed: Broker: Not coordinator"}</code></p><li><p><code class="language-plaintext highlighter-rouge">Error: KafkaError{code=COORDINATOR_LOAD_IN_PROGRESS,val=14,str="Commit failed: Broker: Coordinator load in progress"}</code></p></ul><h2 id="kafka-consumergroup-for-each-topic-vs-kafka-consumergroup-for-multiple-topic">Kafka consumergroup for each topic vs Kafka consumergroup for multiple topic</h2><p>Kafka consumergroup for each topic의 경우 당연히 consumer들에게 하나의 topic에 대해서 partition rebalancing이 된다. 문득 하나의 consumergroup에 여러 topic을 컨슘하는 컨슈머들이 모여있을 경우 rebalancing이 잘될까? 결론은 잘된다. consumergroup내에서도 각각의 컨슈머에게 (topic, partition) 조합이 유일하게 할당이 되어 rebalancing이 잘 된다. <a href="https://stackoverflow.com/questions/57753211/kafka-use-common-consumer-group-to-access-multiple-topics">참고</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/dataengineering/'>DataEngineering</a>, <a href='/categories/kafka/'>Kafka</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Kafka Trouble Shooting - Study Log&url=https://jaegukim.github.io/posts/kafka-trouble-shooting/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Kafka Trouble Shooting - Study Log&u=https://jaegukim.github.io/posts/kafka-trouble-shooting/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Kafka Trouble Shooting - Study Log&url=https://jaegukim.github.io/posts/kafka-trouble-shooting/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copied successfully!')" data-toggle="tooltip" data-placement="top" title="Copy link"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/software-engineering-at-google/">Software Engineering at Google</a><li><a href="/posts/til/">TIL</a><li><a href="/posts/custom-default-backend-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0/">custom error page 띄우기</a><li><a href="/posts/cors-setting/">CORS setting</a><li><a href="/posts/helm-chart/">Helm Chart</a></ul></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/kafka-transaction/"><div class="card-body"> <span class="timeago small" >Dec 19, 2021<i class="unloaded">2021-12-19T13:19:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Kafka Transaction</h3><div class="text-muted small"><p> Kafka Transaction 카프카에서 exactly once delievery를 지원하기 위해서 0.11.0.0 이후 버전 이후부터 카프카 트랜잭션 기능을 지원한다. exactly once delievery가 적용되는 범위는 프로듀서부터 컨슈머 까지 연결되는 파이프라인이다. 하지만 컨슈머에서 여전히 중복 데이터 처리가 발생할 수 있다. Use...</p></div></div></a></div><div class="card"> <a href="/posts/local-kafka-setup/"><div class="card-body"> <span class="timeago small" >Dec 19, 2021<i class="unloaded">2021-12-19T13:45:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Local Kafka Setup</h3><div class="text-muted small"><p> link https://blog.voidmainvoid.net/411</p></div></div></a></div><div class="card"> <a href="/posts/kafka-rebalancing/"><div class="card-body"> <span class="timeago small" >Jan 5, 2022<i class="unloaded">2022-01-05T21:41:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Kafka Rebalancing</h3><div class="text-muted small"><p> 참고</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/trouble-shooting-could-not-find-gem-'nokogumbo~-2.0'-%ED%95%B4%EA%B2%B0%ED%95%98%EA%B8%B0/" class="btn btn-outline-primary" prompt="Older"><p>[Trouble Shooting] Could not find gem 'nokogumbo(~> 2.0)' 해결하기</p></a> <a href="/posts/build-setting/" class="btn btn-outline-primary" prompt="Newer"><p>build setting</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//jaegukim.disqus.com/embed.js', disqusConfig: function() { this.page.title = 'Kafka Trouble Shooting'; this.page.url = 'https://jaegukim.github.io/posts/kafka-trouble-shooting/'; this.page.identifier = '/posts/kafka-trouble-shooting/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/username">Jaegoo.Kim</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://jaegukim.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
