<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Prometheus" /><meta name="author" content="Jaegoo Kim" /><meta property="og:locale" content="en" /><meta name="description" content="Prometheus란? 원래 SoundCloud에서 빌드된 오픈소스 monitorring,alerting toolkit Prometheus는 time series data로 메트릭을 수집및 적재한다. 즉, 메트릭정보는 label이라고 불리는 optional key-value와 함께 기록된 시간이 저장된다." /><meta property="og:description" content="Prometheus란? 원래 SoundCloud에서 빌드된 오픈소스 monitorring,alerting toolkit Prometheus는 time series data로 메트릭을 수집및 적재한다. 즉, 메트릭정보는 label이라고 불리는 optional key-value와 함께 기록된 시간이 저장된다." /><link rel="canonical" href="https://jaegukim.github.io/posts/prometheus/" /><meta property="og:url" content="https://jaegukim.github.io/posts/prometheus/" /><meta property="og:site_name" content="Study Log" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-12-09T12:35:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Prometheus" /><meta name="twitter:site" content="@JaeguKim" /><meta name="twitter:creator" content="@Jaegoo Kim" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Jaegoo Kim"},"dateModified":"2021-12-09T12:35:00+08:00","datePublished":"2021-12-09T12:35:00+08:00","description":"Prometheus란? 원래 SoundCloud에서 빌드된 오픈소스 monitorring,alerting toolkit Prometheus는 time series data로 메트릭을 수집및 적재한다. 즉, 메트릭정보는 label이라고 불리는 optional key-value와 함께 기록된 시간이 저장된다.","headline":"Prometheus","mainEntityOfPage":{"@type":"WebPage","@id":"https://jaegukim.github.io/posts/prometheus/"},"url":"https://jaegukim.github.io/posts/prometheus/"}</script><title>Prometheus | Study Log</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Study Log"><meta name="application-name" content="Study Log"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/22807942?s=460&u=cc1d822a8be2c87ac3aa4917adaadeca5487c515&v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Study Log</a></div><div class="site-subtitle font-italic">“ In order to be irreplaceable, one must always be different” – Coco Chanel</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/JaeguKim" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/JaeguKim" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['kimwithglasses','kakao.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Prometheus</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Prometheus</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Jaegoo.Kim </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, Dec 9, 2021, 12:35 PM +0800" >Dec 9, 2021<i class="unloaded">2021-12-09T12:35:00+08:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1046 words">5 min read</span></div></div><div class="post-content"><h2 id="prometheus란">Prometheus란?</h2><p>원래 SoundCloud에서 빌드된 오픈소스 monitorring,alerting toolkit Prometheus는 time series data로 메트릭을 수집및 적재한다. 즉, 메트릭정보는 label이라고 불리는 optional key-value와 함께 기록된 시간이 저장된다.</p><h3 id="features">Features</h3><p>프로메테우스의 기본 기능은 :</p><ul><li>메트릭 이름과 key-value 쌍으로 식별되는 time series 데이터를 가진 multi-dimensional data model<li>PromQL라는 dimensionality를 leverage하기 위한 flexible query language를 사용한다.<li>분산 저장소에 의존하지 않음; 단일 서버 노드들은 autonomous하다(스스로 자신을 제어한다).<li>time series 수집은 HTTP를 통해서 모델을 model을 pull한다.<li>time series 데이터를 푸시하는 것은 intermediary gateway를 통해서 지원된다.<li>타깃은 service discovery 또는 static configuration을 통해서 발견된다.<li>다양한 모드의 graphing, dashboarding 지원</ul><h3 id="metric이란">Metric이란?</h3><p>메트릭이란 말그대로 numeric mesurements이며, time series란 변화가 계속해서 기록된다는 의미이다. 유저가 측정하고 싶어하는 것은 어플리케이션에 따라서 다르다. 웹서버에서는 request time일수도 있고, 데이터베이스 에서는 활성화된 커넷션들 또는 active queries일수도 있다.</p><p>Metric은 애플리케이션이 왜 특정방식으로 자동이 되는지 이해하는데 있어서 중요한 역할을 한다.</p><h3 id="components">Components</h3><p>프로메테우스 ecosystem은 여러개의 컴포넌트로 구성이 되는데, 많은 경우 optional이다.</p><ul><li>time series data를 scrape하고 저장하는 main Prometheus server<li>애플리케이션 코드를 instrumenting하기 위한 client libraries<li>short-lived jobs을 지원하기위한 push gateway<li>HAProxy, StatsD, Graphite 등과 같은 서비스들에 대한 special-purpose exporters<li>alert들을 핸들하기 위한 alertmanager<li>다양한 support tool들</ul><p>대부분의 프로메테우스 컴포넌트들은 Go로 작성되었고, static binary로 빌드하고 배포하기 쉽게한다.</p><h3 id="architecture">Architecture</h3><p>다음 다이어그램은 프로메테우스와 ecosystem 컴포넌트들의 아키텍쳐이다.</p><p><img data-proofer-ignore data-src="https://prometheus.io/assets/architecture.png" alt="Prometheus architecture" /></p><p>프로메테우스는 short-lived job들을 위한 intermediary push gateway를 통해서 또는 직접적으로 instrumented job 메트릭을 수집한다. 모든 scraped sample들을 로컬로 저장하고 존재하는 데이터로 부터 새로운 time series를 기록하고 집계하기 위한 rule들을 실행하거나 또는 알람을 생성한다. Grafana 또는 다른 API 컨슈머들은 수집된 데이터를 시각화하기 위해서 사용된다.</p><h3 id="언제-적합한가">언제 적합한가?</h3><p>프로메테우스는 순수 numeric 타임 시리즈들을 기록하는데 매우 적합하다. machine-centric monitoring 뿐만 아니라 highly dynamic service-oriented 아키텍쳐를 모니터링하는데 적합하다. 마이크로서비스 세계에서, multi-dimensional data 수집과 쿼리를 지원하는것에 강점을 보인다.</p><p>프로메테우스는 reliability을 위해서 디자인되었다, 장애가 발생한동안 빠르게 문제를 진단할수 있도록 디자인되었다. 각각의 프로메테우스 서버는 독립적이다.(network storage 또는 다른 remote 서비스들에 대해서 의존하지 않는다.)</p><h3 id="언제-적합하지-않은가">언제 적합하지 않은가?</h3><p>프로메테우스는 repliability에 중점을 둔다. 실패 조건들에서도 항상 당신의 시스템에서 어떤 statistics가 이용가능한지 보여준다. 만약 100%정확성이 필요하다면, 예를들어 per-request billing 같은 경우, 프로메테우스는 적합하지 않은데 왜냐하면 수집된 데이터가 충분히 세부적이고 완전하지 않기 때문이다. 그러한 경우 billing 데이터를 수집하고 분석하기 위해서 다른 시스템을 사용하는것이 더 낫고 프로메테우스는 모니터링 목적으로 사용하는것이 좋다.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/devops/'>DevOps</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Prometheus - Study Log&url=https://jaegukim.github.io/posts/prometheus/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Prometheus - Study Log&u=https://jaegukim.github.io/posts/prometheus/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Prometheus - Study Log&url=https://jaegukim.github.io/posts/prometheus/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copied successfully!')" data-toggle="tooltip" data-placement="top" title="Copy link"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/software-engineering-at-google/">Software Engineering at Google</a><li><a href="/posts/til/">TIL</a><li><a href="/posts/custom-default-backend-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0/">custom error page 띄우기</a><li><a href="/posts/cors-setting/">CORS setting</a><li><a href="/posts/helm-chart/">Helm Chart</a></ul></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/thanos/"><div class="card-body"> <span class="timeago small" >Nov 21, 2021<i class="unloaded">2021-11-21T15:02:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Thanos</h3><div class="text-muted small"><p> Thanos aim of project Global query view of metrics Unlimited retention of metrics High availability of components, including Prometheus</p></div></div></a></div><div class="card"> <a href="/posts/testing-github-action-in-local/"><div class="card-body"> <span class="timeago small" >Mar 29, 2022<i class="unloaded">2022-03-29T13:34:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Testing Github Action in local</h3><div class="text-muted small"><p> Using custom docker image for local test Install act brew install act Build custom docker image 1 docker build -t local-airflow-ci . -f ./Dockerfile.ci --build-arg A...</p></div></div></a></div><div class="card"> <a href="/posts/software-engineering-at-google/"><div class="card-body"> <span class="timeago small" >Oct 2<i class="unloaded">2023-10-02T19:12:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Software Engineering at Google</h3><div class="text-muted small"><p> 챕터1 Time and Change Software를 장기적으로 유지보수가능하게 하는 작업은 지속적인 전투(constant battle)이다. Hyrum’s Law API의 충분한 사용자가 있는 경우, 주어진 계약에서 무엇을 약속하는지는 중요하지 않다. : 모든 관찰가능한 당신의 시스템의 행위가 다른 누군가에 의해 의존될 것이다. ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/chart-hooks/" class="btn btn-outline-primary" prompt="Older"><p>Chart Hooks</p></a> <a href="/posts/merge/" class="btn btn-outline-primary" prompt="Newer"><p>MERGE</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//jaegukim.disqus.com/embed.js', disqusConfig: function() { this.page.title = 'Prometheus'; this.page.url = 'https://jaegukim.github.io/posts/prometheus/'; this.page.identifier = '/posts/prometheus/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/username">Jaegoo.Kim</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://jaegukim.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
